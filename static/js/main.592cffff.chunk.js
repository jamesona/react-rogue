(this["webpackJsonpreact-rogue"]=this["webpackJsonpreact-rogue"]||[]).push([[0],{19:function(t,e,i){t.exports=i(26)},25:function(t,e,i){},26:function(t,e,i){"use strict";i.r(e);var a=i(10),n=i.n(a),o=i(17),s=i.n(o),r=i(6),c=i(14),l=i(0),h=i(1),u=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(l.a)(this,t),this.type=e.toString()||"Null Action",this.data=Object(c.a)({},i)}return Object(h.a)(t,null,[{key:"createAction",value:function(e){return function(i){return new t(e,i)}}}]),t}(),f=function(){function t(){var e=this;Object(l.a)(this,t),this.observers=[],this.handleKeys=function(t){var i=u.createAction("move"),a=u.createAction("reset");switch(t.preventDefault(),t.keyCode){case 37:return e.broadcast(i({x:-1,y:0}));case 38:return e.broadcast(i({x:0,y:-1}));case 39:return e.broadcast(i({x:1,y:0}));case 40:return e.broadcast(i({x:0,y:1}));case 13:return e.broadcast(a())}}}return Object(h.a)(t,[{key:"subscribe",value:function(t){this.observers.push(t)}},{key:"unsubscribe",value:function(t){this.observers=this.observers.filter((function(e){return e!==t}))}},{key:"broadcast",value:function(t){var e=t.type,i=t.data;this.observers.forEach((function(t){return t(e,i)}))}},{key:"bindKeys",value:function(){document.addEventListener("keydown",this.handleKeys)}},{key:"unbindKeys",value:function(){document.removeEventListener("keydown",this.handleKeys)}}]),t}(),y=i(13),b=i(18),d=i(4),v=i(2),m=i(7),p=i(5),g=function(){function t(e,i,a,n){Object(l.a)(this,t),this.x=e,this.y=i,this.size=a,this.attributes=Object(c.a)({},n)}return Object(h.a)(t,[{key:"move",value:function(t,e){var i=this.locationFromVector(t,e),a=Object(r.a)(i,2),n=a[0],o=a[1];return Object.assign(this,{x:n,y:o}),[this.x,this.y]}},{key:"locationFromVector",value:function(t,e){return[this.x+t,this.y+e]}},{key:"draw",value:function(t){if(t.fillStyle=this.attributes.color||"#fff",t.textBaseline="hanging",t.font="".concat(this.size,"px monospace"),this.attributes.emoji){var e=this.attributes.emoji||{symbol:"",offset:{x:0,y:0}},i=e.symbol,a=e.offset,n=a.x,o=a.y;t.fillText(i,this.x*this.size+n,this.y*this.size+o)}else{var s=this.attributes.ascii||{symbol:"",offset:{x:0,y:0}},r=s.symbol,c=s.offset,l=c.x,h=c.y;t.fillText(r,this.x*this.size+l,this.y*this.size+h)}}},{key:"takeDamage",value:function(t){this.attributes&&this.attributes.health&&(this.attributes.health-=t)}},{key:"action",value:function(t,e){console.log(t)}}]),t}(),k=function(t){return t[0].toUpperCase()+t.slice(1)},w=function(t){function e(){var t,i;Object(l.a)(this,e);for(var a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return(i=Object(d.a)(this,(t=Object(v.a)(e)).call.apply(t,[this].concat(n)))).attributes={name:"Player",color:"#f00",ascii:{symbol:"@",offset:{x:3,y:1}},emoji:{symbol:"\ud83e\uddd9",offset:{x:-4,y:3}},maxHealth:100,health:100,attack:5,defense:1,score:0},i}return Object(p.a)(e,t),Object(h.a)(e,[{key:"use",value:function(t,e){var i=this,a="Picked up ".concat(t.attributes.name),n=t.attributes.effect(this);Object.entries(n).forEach((function(t,e,n){var o,s=Object(r.a)(t,2),c=s[0],l=s[1];if(i.attributes[c]){i.attributes[c]+=l;var h="max"+k(c);i.attributes[h]&&(i.attributes[c]=Math.min(i.attributes[c],i.attributes[h]))}else i.attributes[c]=l;a+=0===e?" (":", ",a+="".concat((o=c,k(o.replace(/([A-Z])/g," $1")))," ").concat(l>0?"+":"").concat(l),e===n.length-1&&(a+=")")})),e.addToHistory(a)}},{key:"printLeft",value:function(t){t.fillStyle=this.attributes.color="#fff";for(var e=arguments.length,i=new Array(e>1?e-1:0),a=1;a<e;a++)i[a-1]=arguments[a];t.fillText(i.join(" "),this.size,0)}},{key:"printRight",value:function(t){t.fillStyle=this.attributes.color="#fff";for(var e=arguments.length,i=new Array(e>1?e-1:0),a=1;a<e;a++)i[a-1]=arguments[a];t.fillText(i.join(" "),t.canvas.width-i.join(" ").length*this.size,0)}},{key:"draw",value:function(t){Object(m.a)(Object(v.a)(e.prototype),"draw",this).call(this,t),this.printLeft(t,this.hpBar,this.attackLevel,this.defenseLevel),this.printRight(t,this.score)}},{key:"hpBar",get:function(){var t=this.attributes.health/this.attributes.maxHealth,e=Array(10).fill(null).map((function(e,i){return t>=(i+1)/10?"\u25a0":" "})).join("");return"HP: [".concat(e,"] ").concat(this.attributes.health,"/").concat(this.attributes.maxHealth)}},{key:"score",get:function(){return"Score: ".concat(this.attributes.score)}},{key:"attackLevel",get:function(){return"ATT: ".concat(this.attributes.attack)}},{key:"defenseLevel",get:function(){return"DEF: ".concat(this.attributes.defense," (").concat(Math.floor(100*(1-this.damageReduction)),"%)")}},{key:"damageReduction",get:function(){return 1-Math.log(Math.max(this.attributes.defense),1)/10}}]),e}(g),j=function(t,e){return new Array(t).fill(null).map((function(){return new Array(e).fill(null)}))},x=function(){function t(e,i,a,n){Object(l.a)(this,t),this.width=e,this.height=i,this.tileSize=a,this.player=new w(0,0,a),this.entities=[this.player],this.history=["You have entered a dungeon"],this.historyLines=n,this.map=j(e,i),this.floor=1}return Object(h.a)(t,[{key:"add",value:function(t){this.entities.push(t)}},{key:"remove",value:function(t){this.entities=this.entities.filter((function(e){return e!==t}))}},{key:"iterateTiles",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=e;a<this.width;a++)for(var n=i;n<this.height;n++)if(t(a,n,this.getTile(a,n)))return}},{key:"createRandomMap",value:function(){var t=this;this.map=j(this.width,this.height),this.iterateTiles((function(e,i){return t.map[e][i]=Math.round(Math.random())}))}},{key:"createCellularMap",value:function(){var t=this;this.map=j(this.width,this.height);var e=new b.a.Cellular(this.width,this.height,{connected:!0});e.randomize(.475);var i=function(e,i,a){var n=0===e||0===i||e>=t.width-1||i>=t.height-1,o=0===a;t.map[e][i]=o||n?1:0};e.create(i),e.connect(i,1)}},{key:"init",value:function(){this.createCellularMap(),this.moveToValidSpace(this.player)}},{key:"getEntityAtLocation",value:function(t,e){var i=this;return this.entities.find((function(a){return a.x===t&&a.y===e&&a!==i.player}))}},{key:"applyPositionDelta",value:function(t,e,i){return[t.x+e,t.y+i]}},{key:"moveToValidSpace",value:function(t){for(var e=this,i=function(t,i){return e.tileExists(t,i)&&!e.isWall(t,i)&&!e.getEntityAtLocation(t,i)},a=0,n=0,o=0,s=0,c=0;!i.apply(void 0,Object(y.a)((l=this.applyPositionDelta.apply(this,[t].concat(Object(y.a)((u=O(a++),f=Object(r.a)(u,2),n=f[0],o=f[1],u)))),h=Object(r.a)(l,2),s=h[0],c=h[1],l)));){var l,h,u,f;if(a>this.height*this.width)return console.log("Failed to place, something is wrong"),[t.x,t.y]}return console.log("placing ".concat(t.attributes.name," at [").concat(s,", ").concat(c,"]")),t.move(n,o)}},{key:"movePlayer",value:function(t,e){var i,a=this.player,n=a.locationFromVector(t,e),o=Object(r.a)(n,2),s=o[0],c=o[1];if(1!==this.getTile(s,c)){var l=this.getEntityAtLocation(s,c);l&&l.action("bump",this),(null===l||void 0===l?void 0:null===(i=l.definition)||void 0===i?void 0:i.health)||a.move(t,e)}}},{key:"getTile",value:function(t,e){return this.map[t]&&this.map[t][e]}},{key:"tileExists",value:function(t,e){return void 0!==this.getTile(t,e)}},{key:"isWall",value:function(t,e){return 1===this.getTile(t,e)}},{key:"printLog",value:function(t){var e=this;t.fillStyle="#000",t.fillRect(0,this.height*this.tileSize,this.width*this.tileSize,this.historyLines*this.tileSize),t.fillStyle="#fff",t.textAlign="start",this.history.slice(-this.historyLines).forEach((function(i,a){t.fillText(i,e.tileSize,(e.height+a)*e.tileSize)}))}},{key:"draw",value:function(t){this.ended||(this.drawMap(t),this.processEntities(t),this.printLog(t))}},{key:"drawMap",value:function(t){var e=this;this.iterateTiles((function(i,a){1===e.map[i][a]&&e.drawWall(t,i,a)}))}},{key:"processEntities",value:function(t){var e=this;this.entities.forEach((function(i,a){try{i.draw(t,e)}catch(n){}}))}},{key:"drawWall",value:function(t,e,i){t.fillStyle="#000",t.fillRect(e*this.tileSize,i*this.tileSize,this.tileSize,this.tileSize)}},{key:"addToHistory",value:function(t){this.history.push(t)}},{key:"end",value:function(){this.ended=!0}}]),t}();function O(t){if(0===t)return[0,0];var e=Math.floor((Math.sqrt(t+1)-1)/2)+1,i=2*e,a=(1+t-8*e*(e-1)/2)%(8*e),n=0,o=0;switch(Math.floor(a/(2*e))){case 2:n=a-e,o=-e;break;case 3:n=e,o=a%i-e;break;case 0:n=e-a%i,o=e;break;case 1:n=-e,o=e-a%i}return[n,o]}var S=function(t){function e(){return Object(l.a)(this,e),Object(d.a)(this,Object(v.a)(e).apply(this,arguments))}return Object(p.a)(e,t),Object(h.a)(e,[{key:"action",value:function(t,e){"bump"===t&&(e.player.use(this,e),e.remove(this)),"drop"===t&&console.log("drop",this)}}]),e}(g);S.types=[{name:"Treasure",color:"yellow",ascii:{symbol:"$",offset:{x:3,y:3}},emoji:{symbol:"\ud83d\udcb0",offset:{x:-2,y:3}},effect:function(t){return{score:100}}},{name:"Health Potion",color:"red",ascii:{symbol:"!",offset:{x:6,y:3}},emoji:{symbol:"\ud83c\udf56",offset:{x:-4,y:3}},effect:function(t){return{maxHealth:1,health:.25*t.attributes.maxHealth}}},{name:"Long Sword",color:"darkgrey",ascii:{symbol:"/",offset:{x:6,y:3}},emoji:{symbol:"\ud83d\udde1\ufe0f",offset:{x:-4,y:3}},effect:function(t){return{attack:1}}},{name:"Shield",color:"lightgrey",ascii:{symbol:"#",offset:{x:4,y:3}},emoji:{symbol:"\ud83d\udee1\ufe0f",offset:{x:-2,y:3}},effect:function(t){return{defense:1}}}];var T=function(t){function e(){return Object(l.a)(this,e),Object(d.a)(this,Object(v.a)(e).apply(this,arguments))}return Object(p.a)(e,t),Object(h.a)(e,[{key:"action",value:function(t,e){if("bump"===t){var i=e.player.attributes.attack;if(this.takeDamage(i),e.addToHistory("You attack ".concat(this.attributes.name," for ").concat(i," damage")),this.attributes.health<=0){var a=10*this.definition.health;e.addToHistory("".concat(this.attributes.name," was slain (Score +").concat(a,")")),e.player.attributes.score+=a,e.remove(this)}else{var n=e.player.damageReduction,o=Math.floor(this.definition.health/2*n)||1;e.player.takeDamage(o),e.addToHistory("".concat(this.attributes.name," attacks you for ").concat(o," HP")),e.player.attributes.health<=0&&(e.addToHistory("You died"),e.end())}}}},{key:"definition",get:function(){var t=this;return e.types.find((function(e){return e.name===t.attributes.name}))}}]),e}(g);T.types=[{name:"Ogre",color:"lightgrey",ascii:{symbol:"O",offset:{x:2,y:3}},emoji:{symbol:"\ud83d\udc79",offset:{x:-4,y:3}},health:60},{name:"Skeleton",color:"gray",ascii:{symbol:"S",offset:{x:3,y:2}},emoji:{symbol:"\u2620\ufe0f",offset:{x:-5,y:3}},health:20},{name:"Kobold",color:"darkgreen",ascii:{symbol:"k",offset:{x:4,y:3}},emoji:{symbol:"\ud83d\udc32",offset:{x:-3,y:3}},health:30},{name:"Bat",color:"brown",ascii:{symbol:"B",offset:{x:2,y:3}},emoji:{symbol:"\ud83e\udd87",offset:{x:-3,y:4}},health:10},{name:"Rat",color:"brown",ascii:{symbol:"r",offset:{x:2,y:3}},emoji:{symbol:"\ud83d\udc00",offset:{x:0,y:0}},health:10}];var z=function(t){function e(){var t,i;Object(l.a)(this,e);for(var a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return(i=Object(d.a)(this,(t=Object(v.a)(e)).call.apply(t,[this].concat(n)))).attributes={name:"Stairs",color:"black",ascii:{symbol:"<",offset:{x:2,y:2}},emoji:{symbol:"\ud83d\udeaa",offset:{x:0,y:4}}},i}return Object(p.a)(e,t),Object(h.a)(e,[{key:"action",value:function(t,e){if("bump"===t){var i=100*e.floor;e.player.attributes.score+=i,e.floor+=1,e.addToHistory("You go down the stairs (Score +".concat(i,")")),e.createCellularMap(),e.moveToValidSpace(e.player),e.entities=[e.player];var a=new L(e);a.spawnLoot(10),a.spawnMonster(10),a.spawnStairs()}}}]),e}(g),L=function(){function t(e){Object(l.a)(this,t),this.world=e}return Object(h.a)(t,[{key:"randomCoords",value:function(){return[M(this.world.width-1),M(this.world.height-1)]}},{key:"spawn",value:function(t,e){for(var i=0;i<t;i++){var a=e();this.world.add(a),this.world.moveToValidSpace(a)}}},{key:"spawnLoot",value:function(t){var e=this;this.spawn(t,(function(){var t=e.randomCoords(),i=Object(r.a)(t,2),a=i[0],n=i[1];return new S(a,n,e.world.tileSize,S.types[M(S.types.length)])}))}},{key:"spawnMonster",value:function(t){var e=this;this.spawn(t,(function(){var t=e.randomCoords(),i=Object(r.a)(t,2),a=i[0],n=i[1];return new T(a,n,e.world.tileSize,T.types[M(S.types.length)])}))}},{key:"spawnStairs",value:function(){var t=this;this.spawn(1,(function(){var e=t.randomCoords(),i=Object(r.a)(e,2),a=i[0],n=i[1];return new z(a,n,t.world.tileSize)}))}}]),t}();function M(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Math.floor(Math.random()*Math.floor(t)+e)}var E=function(t){var e=t.width,i=t.height,o=t.tilesize,s=t.historyLines,c=Object(a.useRef)(null),l=new f,h=Object(a.useState)(new x(e,i,o,s)),u=Object(r.a)(h,2),y=u[0],b=u[1],d=function(t,e){if(y.ended)"reset"===t&&v();else{var i=Object.assign(new x,y);"move"===t&&i.movePlayer(e.x,e.y),b(i)}},v=function(){var t=new x(e,i,o,s);t.init();var a=new L(t);a.spawnLoot(10),a.spawnMonster(10),a.spawnStairs(),b(t)};return Object(a.useEffect)((function(){v()}),[]),Object(a.useEffect)((function(){return l.bindKeys(),l.subscribe(d),function(){l.unbindKeys(),l.unsubscribe(d)}})),Object(a.useEffect)((function(){var t=c.current.getContext("2d");y.ended?(t.fillStyle="rgba(0,0,0,0.8)",t.fillRect(0,0,e*o,i*o),t.textAlign="center",t.fillStyle="#fff",t.fillText("Game Over",e*o/2,i*o/2-o),t.fillText("Press Enter to Try Again",e*o/2,i*o/2+o),y.printLog(t)):(t.clearRect(0,0,e*o,i*o),y.draw(t))})),n.a.createElement("canvas",{ref:c,width:e*o,height:i*o+s*o,style:{margin:"1px",background:"#3F3F3F"}})};i(25);s.a.render(n.a.createElement(E,{width:40,height:40,tilesize:20,historyLines:10}),document.body)}},[[19,1,2]]]);
//# sourceMappingURL=main.592cffff.chunk.js.map